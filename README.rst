Transceiver test and demonstration for DRTIO
============================================

This repository contains several test and proof-of-concept designs for data and time transfer over high-speed transceivers, which will enable distributed real-time I/O (DRTIO) in ARTIQ.

Communications are between two KC705 boards connected over SFP at 1.25Gbps line rate. Use 1310/1490nm SFPs with a single G.652 fiber (same as White Rabbit - http://www.ohwr.org/projects/white-rabbit/wiki/SFP).

Requires PySerial, Migen 0.4+, MiSoC, and ARTIQ 2.0+.

This work was supported by the Army Research Lab.

Remote LED demonstration
------------------------

Build the designs by running ``demo_remote_led.py``. The four DIP switches on the transmitting KC705 control LEDs 2-5 on the receiving KC705. LEDs 0-1 on both boards blink from the system and transceiver data clocks, respectively. 

PRBS demonstration
------------------

Build the designs by running ``demo_prbs.py``. The transmitter outputs a pseudo-random pattern generated by a LFSR, that the receiver synchronizes to and verifies. The receiver counts errors and reports them on its RS232 link. Use ``demo_prbs.py --readout /dev/ttyUSBx`` to get the current value. The error count increases at the beginning while the receiver is synchronizing to the transmitter, but it stays constant after the receiver is locked - meaning the transmission is being received correctly.

Due to the use of a self-synchronizing V.34-style PRBS checker and of 8b10b encoding, a single bit error on the fiber may cause multiple bit errors to be reported.

Managing multiple KC705 boards with OpenOCD
-------------------------------------------

1. Obtain the serial number of each board using ``lsusb -v``. It should be a number such as ``123456789012``.
2. Run the following command to load a bitstream into the corresponding board's FPGA:
   ``openocd -f board/kc705.cfg -c "ftdi_serial 123456789012; init; pld load 0 bitstream.bit; exit;"``

If you are using the OpenOCD Conda package:

1. locate the OpenOCD scripts directory with:
   ``python3 -c "import artiq.frontend.artiq_flash as af; print(af.scripts_path)"``
2. add ``-s <scripts directory>`` to the OpenOCD command line.
